Migrating Hive data from HDP 2.x or HDP 3.x to CDP OneCloudera Docs
Migrating Hive data from HDP 2.x or HDP 3.x to CDP One
The recommended way to migrate Hive data from HDP to CDP One depends on the
        types of tables you are migrating: external, legacy-managed, or ACID (managed)
        tables.
The default behavior in CDP has changed so that all newly created managed tables are
            transactional tables by default. To minimize impact to applications during upgrade and
            keep legacy behavior, all non-acid legacy tables (both managed and external) will be
            converted to external tables in CDP during migration. Legacy ACID tables will be
            migrated to managed ACID tables in CDP.
Scenario 1: Migrating Non-ACID tables (SCHEMA_ONLY + distcp)
All managed and external Non-ACID tables will be migrated to external tables in CDP using
                the following components:
HMS-Mirror: using the SCHEMA_ONLY mode to transfer metadata
DistCP

In this scenario, HMS-Mirror and distcp are triggered from the source cluster (LEFT): 


If direct Hive connectivity from on-prem to CDP is not available, you can dump of the schema to export it, and then preform a re-run manually in the target cluster.

Scenario 2: Migrating ACID tables (HYBRID + MIGRATE_ACID)
All managed ACID source tables (applicable to HDP) are migrated to ACID tables in CDP
                using HMS Mirror in the HYBRID migrate-acid mode with the
                intermediate-storage option. This approach migrates both data and metadata using
                Hive queries, and stages the data in an intermediate-storage location on S3. This
                approach avoids the need to link the target cloud environment with the
                on-prem source.
In this scenario, HMS-Mirror is triggered from the source cluster (LEFT), as shown in
                the following diagram:




Migration prerequisitesMigrating Hive metadata to CDP One requires setup tasks, some of which are     related to security.HMS Mirror command summary There are several critical options you need to use with the hms-mirror command to   migrate HDP to CDP migration.Migrating Hive metadata You first perform a dry run of HMS Mirror, and check the output. You see how to         execute HMS Mirror to migrate the Hive metadata in HMS on the HDP cluster to the CDP as a         Service cluster. HMS Mirror generated filesYou use generated scripts, reports, and other files as you migrate the table metadata     and data. Reports generated by HMS Mirror include information about HMS Mirror configurations. A     list of tables on left HDP and translated tables on right CDP cluster are also     generated.Verifying metadata migrationAfter running the HMS Mirror tool to migrate Hive metadata from HDP         to CDP One, you take a look at the migrated metadata on the CDP One cluster.    Migrating actual Hive dataAlthough HMS Mirror migrates only Hive metastore (HMS) metadata, not the actual Hive data, the tool         generates a script for running the Hadoop DistCp tool. Using DistCp, you migrate actual data from HDP to CDP One.     Adjust AVRO table schema URLsIf any of your Hive tables are in AVRO format, before migration already created the         AVRO schema on the CDP object store. After migration, you must change the URLs in table         properties to point to the CDP location.Verifying actual Hive data migrationAfter running the DistCp to migrate Hive data from HDP to CDP One, you take         a look at the migrated data on the CDP One cluster. Table locationsAfter migration from HDP 2.x, the relative paths for databases, tables, and partitions    on the destination CDP One cluster are different from HDP 2.x. Fixing statisticsUpgrading or migrating from Hive 1 or Hive 2 to Hive 3 might result in missing         statistics. In Hive 3, these missing statistics, when detected by the cost-based optimizer         (CBO), could cause datasets to be disregarded. You need to fix these statistics after         upgrading. Changes to HDP Hive tablesYou need to locate and use your Apache Hive 3 tables after moving to CDP. You also need     to understand the changes that occur during the process.Parent topic: Migrating data from HDP to CDP One